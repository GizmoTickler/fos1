# Examples of Cilium Network Policies generated by the system
# These demonstrate how high-level security policies are translated
# to Cilium network policies

---
# Example 1: Zone-based firewall rule (LAN to WAN)
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: zone-lan-to-wan
spec:
  description: "Allow web traffic from LAN to WAN zone"
  endpointSelector:
    matchLabels:
      zone: wan
  ingress:
  - fromEndpoints:
    - matchLabels:
        zone: lan
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP
      - port: "443"
        protocol: TCP
      # L7 HTTP filtering
      rules:
        http:
        - method: "GET"
        - method: "POST"
          path: "/api/v1/.*"

---
# Example 2: NAT configuration
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: nat-lan-outbound
  labels:
    type: nat
    network: 192-168-1-0-24
spec:
  description: "NAT for LAN subnet to WAN interface"
  endpointSelector:
    matchLabels:
      interface: eth0
  egress:
  - toEndpoints:
    - matchLabels:
        interface: eth0
  ingressDeny:
  - fromEntities:
    - "world"
    # Following exceptions apply
    toPorts:
    - ports:
      - port: "443"
        protocol: TCP

---
# Example 3: VLAN policy
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: vlan-10-to-20
  labels:
    type: vlan-routing
    from-vlan: "10"
    to-vlan: "20"
spec:
  description: "Allow limited traffic from VLAN 10 to VLAN 20"
  endpointSelector:
    matchLabels:
      vlan: "20"
  ingress:
  - fromEndpoints:
    - matchLabels:
        vlan: "10"
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP
      - port: "443"
        protocol: TCP
      - port: "53"
        protocol: UDP

---
# Example 4: Application awareness with DPI
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: dpi-app-http
  labels:
    type: dpi
    app: http
spec:
  description: "Allow HTTP traffic with DPI inspection"
  endpointSelector:
    matchLabels:
      app: web-server
  ingress:
  - fromEndpoints:
    - matchLabels:
        org: client
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP
      rules:
        http:
        - method: "GET"
          path: "/public/.*"
          headers:
          - "X-DPI-Classified: http"

---
# Example 5: Inter-VLAN routing with QoS
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: vlan-qos-policy
  labels:
    type: vlan-qos
spec:
  description: "VLAN routing with QoS enforcement"
  endpointSelector:
    matchLabels:
      interface: internal
  egress:
  - toCIDR:
    - 192.168.100.0/24
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP
      - port: "443"
        protocol: TCP
      rules:
        http:
        - method: "GET"
          headers:
          - "X-QoS-Class: high-priority"
  - toCIDR:
    - 192.168.200.0/24
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP
      - port: "443"
        protocol: TCP
      rules:
        http:
        - method: "GET"
          headers:
          - "X-QoS-Class: low-priority"

---
# Example 6: VRF isolation
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: vrf-isolation-customer-a
  labels:
    type: vrf
    vrf-id: "10"
spec:
  description: "VRF isolation for Customer A"
  endpointSelector:
    matchLabels:
      vrf: "customer-a"
  ingress:
  - fromEndpoints:
    - matchLabels:
        vrf: "customer-a"
  egress:
  - toEndpoints:
    - matchLabels:
        vrf: "customer-a"
  - toEndpoints:
    - matchLabels:
        service: "shared"
    toPorts:
    - ports:
      - port: "53"
        protocol: UDP
      - port: "67"
        protocol: UDP